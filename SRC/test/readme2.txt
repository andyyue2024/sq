
一、模型思路
5-9 使用指数平滑移动平均线 talib.MACD 进行回测
1.选择一个标的，为期1年回测
2.按天计算talib.MACD
3.根据macd > 0，调用order_volume买入200股；根据macd < 0，调用order_volume卖出200股

5-10 使用相对强弱指数 talib.RSI 进行回测
1.选择一个标的，为期1年回测
2.按天计算talib.RSI
3.rsi < 30，调用order_volume买入200股；根据macd > 70，调用order_volume卖出200股

5-12 Dual Thrust 轨道突破策略
1.选择一个标的，为期1年回测
2.按天计算range = np.max([hh - hc, lc - ll])
   上轨道价格 range_up_price = data_now_open + context.k1 * range
3.根据市场价data_now_price > range_up_price，调用order_target_percent买入到仓位0.75；
  根据市场价data_now_price < range_up_price，调用order_target_percent卖出到仓位0。

5-13 Dynamic Breakout II 轨道突破策略
1.选择一个标的，为期1年回测
2.按天计算upBand、buyPoint、lowBand、sellPoint
3.根据((close[-1] > upBand) and (current_price > buyPoint)):，调用order_target_percent买入到仓位1；
  根据((close[-1] < lowBand) and (current_price < sellPoint))，调用order_target_percent卖出到仓位0。

6-2 单因子选股轮动 回测。因子NPGRT
1.选取一个指数，上证50
2.按天/周/月 获取指数对应成分股列表
3.获取所有成分股财务数据 归属母公司净利润增长率NPGRT，并排序
4.取前5名成分股，当天只等额持仓这5指标的。其他全部清仓

6-6 ~ 6-7 使用 成长模型或霍华.罗斯曼模型 进行回测
1.选取一个指数，上证50或上证180
2.按天/周/月 获取指数对应成分股列表
  获取所有成分股根据 成长模型或霍华．罗斯曼 打分，并排序。
  (其中成长模型的排序因子为息税前利润率EBITG、归属母公司净利润增长率NPG、营业总收入增长率TAG、营业毛利润GPG、营业利润率OPG、每股现金流量净额OCG。
  霍华.罗斯曼模型的过滤因子为总市值TOTMKTCAP、市现率PCTTM、归属母公司净利润增长率NPGRT营业总收入增长率TAGRT；
  排序因子为净资产收益率_平均(扣除非经常损益)ROEAVGCUT、每股股东自由现金流量FCFEPS 	 )
3.取前5名成分股，当天只等额持仓这5指标的。其他全部清仓

7-1 MACDModel 进行回测
1.选取一个指数，上证50或上证180
2.按天/周/月 获取指数
3.收盘价做MACD_CN。当macd[-2] < 0 < macd[-1]时，买入；当macd[-2] > 0 > macd[-1]时，卖出。

7-2 基于放量技术因子的回测
1.选取一个指数，上证50或上证180
2.按天/周/月 获取指数对应成分股列表
3.卖出条件：当天价格 > symbol_buy_pirce* 1.3 或者 当天价格 < symbol_buy_pirce* 0.7
4.买入条件：首先，选出满足(过去14收盘价的标准差<0.05)的标的；
          然后，选出满足(当日成交量是前一天5倍以上)的标的；
          最后，如果当前价格大于前一天收盘价就买入。


7-3 改进的RSRS因子 回测
1.选取一个指数，上证50或上证180
2.按天/周/月 获取指数
3.计算标的 的RSRS得分。当rsrs_weight > 0.7时，买入；当rsrs_weight < -0.7时，卖出。

7-4 一个回测成功率100%的中长线买卖例子 回测
1.选取一个指数，上证50或上证180
2.按天/周/月 获取指数对应成分股列表
3.卖出条件：均线（5日线超过10日线10%，10日线超过30日线10%）, 换手率>15%
4.买入条件：找到昨天之前成交量大于昨天的成交量（0.8倍），这个区间的天数大于30天
          昨天单日成交量大于该区间的平均成交量的2倍
          区间价格波动小于10%


8-1 中证红利策略 防守型策略 回测。 收益率高
1.选取一个指数，上证50或上证180
2.按天/周/月 获取指数对应成分股列表
3.卖出条件：如果 指数开盘价 < 过去55天收盘价均值时，全部卖出。并且不可买入。
4.买入允许：如果 指数最近3天每天的开盘价 >=过去55天收盘价均值时，进入可买状态。
5.进一步操作：首先记录所持仓标的的历史最高价和最低价
          第二选出PETTM > 0的标的。
          第三按照defensive_strategy排序
          第四过滤掉黑名单里的标的
          第五选取取前5的标的
          第六卖出不再 选取标的列表中的 持仓。防止反复买卖
          第七如果标的当前开盘价 < 历史最高价*0.93，则卖出；并加入黑名单。  或者如果 历史最高价 大于 历史最低价*1.3，则卖出。
          第八如果未持有该标的且不在黑名单中，当前一天未涨停时，则买入。


8-2 一个自定义多因子策略
1.选取一个指数，上证50或上证180
2.按天/周/月 获取指数对应成分股列表
3.获取所有成分股，根据7个因子模型 打分，并排序。
        净资产收益率_平均(扣除非经常损益)从大到小，权重2；  ROEAVGCUT
        股息率(滚动12月-按证监会口径)从大到小，权重1；DY
        市净率从小到大，权重3；PB
        投入资本回报率从大到小，权重4；ROIC
        历史贝塔从小到大，权重2；
        自定义波动率指标从小到大权重10，

9-4、9-5 使用 回归分析 价格预测。 回测
1.对标的 7日内的开盘价和收盘价，使用OLS线性回归
2.根据开盘价预测收盘价
3.当收盘价高于开盘价时买入


9-6 使用TensorFLow的逻辑回归进行回测
1.对标的近60天内的开盘价、收盘价、最高、最低、成交量，使用TensorFLow进行训练。预设标志位，收盘价大于开盘价时，设置为1。
2.获取当前的开盘价、收盘价、最高、最低、成交量，使用训练好的分类器进行预测，返回预测的标志位。
3.根据标志位进行买入

9-7 使用支持向量机进行回测
1.对标的某段时间内的数据生成
    因子x_train[close_mean, volume_mean, max_mean, min_mean, vol, return_now, std]，
    y_train[收盘价大于5日前收盘价与否的标志]；
    使用SVM的分类器进行训练。
2.获取当前的[close_mean, volume_mean, max_mean, min_mean, vol, return_now, std]，使用训练好的分类器进行预测，返回预测的标志位。
3.根据标志位进行买入


10-1 Fama-French模型的实现与回测。回归模型。
1.选取一个指数，上证50或上证180
2.按天/周/月 获取指数对应成分股列表
3.获取所有成分股。
        获取[股票代码. 股票收益率, 账面市值比的分类, 市值的分类, 流通市值]
        计算SMB、HML和市场收益率。
        对每只股票进行回归获取其alpha值
        获取alpha最小并且小于0的10只的股票进行操作(若少于10只则全部买入)

10-2 PB-ROE模型实现与回测。回归模型。
1.选取一个指数，上证50或上证180
2.按天/周/月 获取指数对应成分股列表
3.获取所有成分股。
        筛选出NPGRT > 21 and TAGRT > 20的标的列表
        获取所有标的的PB、ROE数据。并使用最新二乘法OLS做回归。
        对PB残差进行排序。
        选取前8项买入。

10-3 多因子模型实现与回测。回归模型。
1.选取一个指数，上证50或上证180
2.按天/周/月 获取指数对应成分股列表
3.获取所有成分股，选取前5项买入。
        # ROE/ROIC 的std < 给定的std。其中，ROE 净资产收益率_平均(扣除非经常损益)；ROIC 投入资本回报率。
        # PETTM 市盈率TTM, 11 < PETTM  < 27
        # NPGRT 归属母公司净利润增长率 10 < NPGRT < 39
        # TAGRT 营业总收入增长率 10 < TAGRT < 39


11-12 平稳性和配对交易。配对交易掘金 回测
1.初始值：找出相关性强的股票。
        验证ccb的平稳性。验证abchina的平稳性。
        ccb与abchina做系数回归分析，确立系数和截距值。
        计算残差，并检验残差是否平稳。如果不平稳，则结束，实验失败。
2.买入标准：当残差d_value 大于 均值mean + 3个标准差std时，买入ccb。当残差d_value 小于 均值mean - 3个标准差std时，买入ccb。
3.其他情况：清仓。




二、掘金量化常用函数
查询标的历史行情 history_n
查询指数历史成分股 get_history_constituents
返回指定的symbols的标的日指标数据 get_history_instruments
查询所有标的基本面财务数据 get_fundamentals_n
查询基本面财务数据 get_fundamentals
调仓到目标持仓比例 order_target_percent
调仓到目标持仓量 order_target_volume
返回指定日期的上一个交易日 get_previous_trading_date

三、书本内容
2-1 ~ 2-3 线程
3-1 ~ 3-2 NumPy使用实例
3-4 ~ 3-8 Matplotlib使用实例(点图)、  scipy使用实例（正态分布下的相关性）
3-9 ~ 3-10、3-13 四分图
3-11、3-14 折线图
3-12、3-15 热点图 属性相关性
4-1 掘金量化demo

5-1 ~ 5-2 talib金融工具库  滑动平均值 talib.MA
5-3 指数平均数指标 talib.EMA
5-4 ~ 5-6 指数平滑移动平均线 talib.MACD
Talib_CN  国内常用金融指标SMA_CN、RSI_CN、KDJ_CN、MACD_CN
5-7 累计派发线 资金流量 talib.AD 、talib.ADX  折线图
5-8 蜡烛图(K线图)的形态识别  如：talib.CDL2CROWS
5-9 使用指数平滑移动平均线 talib.MACD 进行回测
5-10 使用相对强弱指数 talib.RSI 进行回测
5-11 布林线指标 talib.BBANDS   上下限折线图
5-12 Dual Thrust 轨道突破策略
5-13 Dynamic Breakout II   轨道突破策略

6-1 查询指数历史成分股，查询所有标的基本面财务数据
6-2 单因子选股轮动 回测。因子NPGRT
6-3、6-5 NumPy使用实例 两个序列的相关性、信息系数IC 函数 np.corrcoef
6-4 StatsModels使用实例，最小二乘法OLS 求解 一元线性回归
6-6 多因子模型：成长模型、霍华．罗斯曼。使用 多因子模型 进行回测。
6-7 成长模型 进行回测
7-1 Talib_CN.MACD_CN 进行回测
7-2 基于放量技术因子的回测
7-3 改进的RSRS因子 回测
7-4 一个回测成功率100%的中长线买卖例子 回测
8-1 中证红利策略 防守型策略 回测。 收益率高
8-2 一个自定义多因子策略

9-1 最小二乘法 算法
9-2 梯度下降法
9-3 最小二乘法 回归分析。 显示
    Tensorflow批量单线性回归_双变量
9-4、9-5 使用 回归分析 价格预测。 回测
9-6 使用TensorFLow的逻辑回归进行回测
9-7 使用支持向量机进行回测

10-1 Fama-French模型的实现与回测。回归模型。
10-2 PB-ROE模型实现与回测。回归模型。
10-3 获取全部A股股票列表，进行PB-ROE回测
10-4 使用自定义股票池进行PB_ROE模型选股
10-5 对当前全A股的股票的PB-ROE可视化

11-1 ~ 11-5 NumPy、Pandas实例。相关性、均值、方差、标准差、协方差
11-6 ~ 11-7 statsmodels实例。协整性、序列的平稳性验证。adfuller
11~8 平稳性和配对交易。找出相关性强的股票
11-9 平稳性和配对交易。验证ccb的平稳性。验证abchina的平稳性。
11-10 平稳性和配对交易。ccb与abchina做系数回归分析，确立系数和截距值。
11-11 平稳性和配对交易。计算残差，并检验残差是否平稳。如果不平稳，则结束，实验失败。
11-12 平稳性和配对交易。配对交易掘金 回测













